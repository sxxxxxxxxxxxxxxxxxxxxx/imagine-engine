# 🎯 最终测试指南 - 确保100%可用

## 📋 **完整测试流程（按顺序执行）**

### 🔴 阶段1: 清除旧数据（2分钟）

#### Step 1.1: 清除Supabase测试用户

**链接**: https://supabase.com/dashboard/project/ryycsolimgocffujpunq/sql/new

**执行SQL**（复制`🗑️_清除测试用户数据.sql`的内容）:
```sql
DELETE FROM public.usage_logs;
DELETE FROM public.transactions;
DELETE FROM public.subscriptions;
DELETE FROM public.profiles;
DELETE FROM auth.users;
```

**验证**:
```sql
SELECT COUNT(*) FROM auth.users;
-- 应该返回 0
```

#### Step 1.2: 清除浏览器数据

按 `F12` → Console:
```javascript
localStorage.clear();
sessionStorage.clear();
location.reload();
```

#### Step 1.3: 重启服务器

```bash
Ctrl+C
npm run dev
```

---

### ✅ 阶段2: 测试完整注册流程（3分钟）

#### Step 2.1: 注册新用户

1. 访问 http://localhost:3000
2. 点击右上角"登录/注册"
3. **应该弹出精美注册框** ✅
4. 输入邮箱: `admin@imagine.com`
5. 输入密码: `Admin123!`
6. 点击"立即注册并生成"

**预期结果**:
- ✅ 注册成功
- ✅ **自动登录**（无需再次输入密码）
- ✅ 模态框关闭
- ✅ 顶部显示: `admin` + `⚡ 0/10`

#### Step 2.2: 验证自动登录

注册成功后：
- ✅ 右上角显示用户名（admin）
- ✅ 显示配额（⚡ 0/10）
- ✅ 点击用户名弹出菜单（Dashboard、登出）

#### Step 2.3: 测试刷新页面

1. 按 `F5` 刷新
2. ✅ **仍然显示已登录**（不会跳登录）
3. ✅ **配额仍然显示**（⚡ 0/10）

#### Step 2.4: 测试关闭浏览器

1. 关闭浏览器
2. 重新打开 http://localhost:3000
3. ✅ **仍然显示已登录**（Session持久化成功）

---

### ✅ 阶段3: 测试配额管理（5分钟）

#### Step 3.1: 测试生成图片

1. 访问 /create
2. 输入提示词: "一只可爱的橘猫"
3. 点击"开始创作"
4. ✅ **生成成功**（不跳登录）
5. ✅ **配额变成**: ⚡ 1/10
6. **刷新页面，配额应该保持** ✅

#### Step 3.2: 测试编辑图片

1. 访问 /edit
2. 上传任意图片
3. 选择"背景移除"
4. 点击"开始编辑"
5. ✅ **编辑成功**
6. ✅ **配额变成**: ⚡ 2/10

#### Step 3.3: 测试配额用尽

1. 继续生成图片
2. 第10次生成成功后
3. ✅ **配额变成**: ⚡ 10/10（红色）
4. 尝试第11次生成
5. ✅ **显示错误**: "配额已用完，请升级套餐"
6. ✅ **无法继续生成**

---

### ✅ 阶段4: 测试Dashboard（2分钟）

#### 访问用户仪表板

1. 点击右上角用户名
2. 点击"仪表板"
3. 访问 http://localhost:3000/dashboard

**应该看到**:
- ✅ 环形进度条（使用百分比）
- ✅ 总配额: 10 张
- ✅ 已使用: 10 张（或您实际使用的数量）
- ✅ 剩余: 0 张
- ✅ 套餐类型: FREE
- ✅ 最近使用记录（带缩略图）
- ✅ API配置卡片

---

### ✅ 阶段5: 测试退出和重新登录（2分钟）

#### Step 5.1: 退出登录

1. 点击右上角用户名
2. 点击"登出"
3. ✅ **退出成功**
4. ✅ **配额显示消失**
5. ✅ **右上角变成"登录/注册"按钮**

#### Step 5.2: 重新登录

1. 点击"登录/注册"
2. 点击底部"登录"切换到登录模式
3. 输入: admin@imagine.com / Admin123!
4. 点击"登录"
5. ✅ **登录成功**
6. ✅ **配额显示恢复**（⚡ 10/10）

---

## 📊 **验证清单**

### ✅ 注册功能
- [ ] 点击按钮弹出模态框（不跳转）
- [ ] 可以输入邮箱密码
- [ ] 注册成功（不报错）
- [ ] **自动登录**（不需要再次输入密码）
- [ ] 顶部显示用户名和配额

### ✅ 登录状态
- [ ] 刷新页面后仍然登录
- [ ] 关闭浏览器后仍然登录
- [ ] 配额显示正常

### ✅ 配额管理
- [ ] 初始: 0/10
- [ ] 生成成功: +1
- [ ] 编辑成功: +1
- [ ] 显示格式: 已用/总数
- [ ] 用完后无法继续

### ✅ 用户体验
- [ ] 注册流程顺畅
- [ ] 无重复登录
- [ ] 配额实时更新
- [ ] Dashboard 信息完整

---

## 🎊 **成功标准**

所有勾选框打勾后，系统100%可用！

您将拥有一个**完整的商业化AI图像生成平台**！

---

**现在立即执行阶段1（清除旧数据）！** 🚀

详细步骤查看: `✨_完善用户体验.md`

